//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.0
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
using System;
using Horizon.Core;
using UnityEngine;
using Horizon.Core.WeakSubscription;
using System.Linq;


namespace Horizon.Combat.Models
{
	[Flags]
	// all the differant types of highlights, and their priority
	public enum LogicalHighlightState
	{
		// values must be power of two
		// lower valus have lower priority
		//None = 0,
		MovementRange = 1,
		MovementPath = 2,
		TargetingRange = 4,
		EffectRange = 8
		//these are just example states. we should come up with different ones when we know what we need
	}

	public static class LogicalHighlightStateExtension
	{
		public static LogicalHighlightState EnableHighlightState(this LogicalHighlightState self, LogicalHighlightState other)
		{
			return self |= other;
		}

		public static LogicalHighlightState DisableHighlightState(this LogicalHighlightState self, LogicalHighlightState other)
		{
			return self ^= other; 
		}

		public static bool stateIsEnabled(this LogicalHighlightState self, LogicalHighlightState other)
		{
			return (self & other) == other;
		}

		public static LogicalHighlightState EffectiveHighlightState(this LogicalHighlightState self)
		{
			//set to the lowest priority
			LogicalHighlightState effectiveState = LogicalHighlightState.MovementRange ^ LogicalHighlightState.MovementRange;

			foreach(var State in Enum.GetValues(typeof(LogicalHighlightState)).Cast<LogicalHighlightState>())
			{
				if((int)State > (int)effectiveState &&  self.stateIsEnabled(State)) effectiveState = State;
			}

			return effectiveState;
		}
	}

	public class Cell : ModelBase
	{		
		//[HideInInspector]
		public LogicalHighlightState HighlightState
		{
			get
			{
				return m_highlightState;
			}
			set
			{

				SetPropertyFeild(ref m_highlightState, value, () => HighlightState);
			}
		}

		protected override void Init ()
		{
			base.Init ();
			resetPosition ();
		}

		//can the cell be walked over
		public bool Passable
		{
			get
			{
				return m_passableSerilized;
			}
			set
			{
				SetPropertyFeild(ref m_passableSerilized,value,() => Passable);
			}
		}

		private void resetPosition ()
		{
			transform.localPosition = new Vector3 (GridPosition.x + 0.5f, 0, GridPosition.y + 0.5f);
		}

		void resetName ()
		{
			gameObject.name = "(" + GridPosition.x + "," + GridPosition.y + ")";
		}

		[HideInInspector]
		public GridPoint GridPosition
		{
			get
			{
				return m_gridPositionSerilized;
			}
			set
			{
				if(SetPropertyFeild(ref m_gridPositionSerilized, value,() => GridPosition))
				{
					resetName ();
					resetPosition ();
				}
			}
		}

		[HideInInspector]
		public Grid grid
		{
			get
			{
				return m_gridSerilized;
			}
			set
			{
				if(SetPropertyFeild(ref m_gridSerilized, value,() => grid))
				{
					resetPosition ();
				}
			}
		}

		[SerializeField]
		private bool m_passableSerilized = true;

		[SerializeField]
		private GridPoint m_gridPositionSerilized;

		[SerializeField]
		private Grid m_gridSerilized;

		private LogicalHighlightState m_highlightState = LogicalHighlightState.MovementRange ^ LogicalHighlightState.MovementRange;
	}
}

